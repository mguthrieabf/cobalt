{% extends 'base.html' %}

{% load static %}

{% block content %}

  <div class="container">
    <h2>All Forums</h2>
    {% for forum in forums %}
    <div class="row">
      <div class="col-md-8 align-self-center">
        <div class="card card-block">
          <div class="card-body">
            <h4 class="card-title"><a href="{% url "forums:post_list_single_forum" forum_id=forum.id %}">{{ forum.title }} ({{ forum.count }} post{{ forum.count|pluralize}})</a></h4>
            <p class="category">{{ forum.description }}</p>
            <h4>Latest Post</h4>
             {{ forum.latest_title }} {{ forum.latest_author }} {{ forum.latest_date }}
          </div>
        </div>
      </div>
      <div class="col-md-4 my-auto">
        <a href="{% url "forums:post_list_single_forum" forum_id=forum.id %}" class="btn btn-sm btn-primary">View</a>

        {% if forum.follows %}
          <button class="btn btn-sm btn-info cobalt-follow" id="button-{{ forum.id }}">Un-follow</button>
        {% else %}
          <button class="btn btn-sm btn-success cobalt-follow" id="button-{{ forum.id }}">Follow</button>
        {% endif %}

      </div>
    </div>
    {% endfor %}
  </div>

{% endblock %}

{% block footer %}

<script>

  $(document).ready(function () {

// Toggle following or not following a forum
// set this initially by class
    $(".cobalt-follow").click(function () {
        forum = this.id.split('-')[1];
        status = this.innerText;
        if (status == "FOLLOW"){
          var url = "/forums/forum/follow/" + forum +"/";
          $("#button-" + forum).html("Un-Follow");
          $("#button-" + forum).toggleClass('btn-success btn-info');
        } else {
          var url = "/forums/forum/unfollow/" + forum +"/";
          $("#button-" + forum).html("Follow");
          $("#button-" + forum).toggleClass('btn-info btn-success');

        }
        $.ajax({
            url: url,
            context: document.body,
            success: function(txt){
            }
        });
     });
  });



</script>

{% endblock %}
